{"version":3,"file":"reactjs-popup.umd.development.js","sources":["../src/hooks.tsx","../src/styles.ts","../src/Utils.ts","../src/index.tsx"],"sourcesContent":["import { useEffect, RefObject, useLayoutEffect } from 'react';\n\nexport const useOnEscape = (\n  handler: (event: KeyboardEvent) => void,\n  active = true\n) => {\n  useEffect(() => {\n    if (!active) return;\n    const listener = (event: KeyboardEvent) => {\n      // check if key is an Escape\n      if (event.key === 'Escape') handler(event);\n    };\n    document.addEventListener('keyup', listener);\n\n    return () => {\n      if (!active) return;\n      document.removeEventListener('keyup', listener);\n    };\n  }, [handler, active]);\n};\n\nexport const useRepositionOnResize = (handler: () => void, active = true) => {\n  useEffect(() => {\n    if (!active) return;\n    const listener = () => {\n      handler();\n    };\n\n    window.addEventListener('resize', listener);\n\n    return () => {\n      if (!active) return;\n      window.removeEventListener('resize', listener);\n    };\n  }, [handler, active]);\n};\n\nexport const useOnClickOutside = (\n  ref: RefObject<HTMLElement> | RefObject<HTMLElement>[],\n  handler: (event: TouchEvent | MouseEvent) => void,\n  active = true\n) => {\n  useEffect(() => {\n    if (!active) return;\n    const listener = (event: TouchEvent | MouseEvent) => {\n      // Do nothing if clicking ref's element or descendent elements\n      const refs = Array.isArray(ref) ? ref : [ref];\n\n      let contains = false;\n      refs.forEach(r => {\n        if (!r.current || r.current.contains(event.target as Node)) {\n          contains = true;\n          return;\n        }\n      });\n      event.stopPropagation();\n      if (!contains) handler(event);\n    };\n\n    document.addEventListener('mousedown', listener);\n    document.addEventListener('touchstart', listener);\n\n    return () => {\n      if (!active) return;\n      document.removeEventListener('mousedown', listener);\n      document.removeEventListener('touchstart', listener);\n    };\n  }, [ref, handler, active]);\n};\n\n// Make sure that user is not able TAB out of the Modal content on Open\nexport const useTabbing = (\n  contentRef: RefObject<HTMLElement>,\n  active = true\n) => {\n  useEffect(() => {\n    if (!active) return;\n    const listener = (event: KeyboardEvent) => {\n      // check if key is an Tab\n      if (event.keyCode === 9) {\n        const els = contentRef?.current?.querySelectorAll(\n          'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex=\"0\"]'\n        );\n\n        const focusableEls = Array.prototype.slice.call(els);\n        if (focusableEls.length === 1) {\n          event.preventDefault();\n          return;\n        }\n\n        const firstFocusableEl = focusableEls[0];\n        const lastFocusableEl = focusableEls[focusableEls.length - 1];\n        if (event.shiftKey && document.activeElement === firstFocusableEl) {\n          event.preventDefault();\n          lastFocusableEl.focus();\n        } else if (document.activeElement === lastFocusableEl) {\n          event.preventDefault();\n          firstFocusableEl.focus();\n        }\n      }\n    };\n\n    document.addEventListener('keydown', listener);\n\n    return () => {\n      if (!active) return;\n      document.removeEventListener('keydown', listener);\n    };\n  }, [contentRef, active]);\n};\n\nexport const useIsomorphicLayoutEffect =\n  typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n","import React from 'react';\n\ntype PopupStyle = {\n  popupContent: {\n    tooltip: React.CSSProperties;\n    modal: React.CSSProperties;\n  };\n  popupArrow: React.CSSProperties;\n  overlay: {\n    tooltip: React.CSSProperties;\n    modal: React.CSSProperties;\n  };\n};\n\nconst Style: PopupStyle = {\n  popupContent: {\n    tooltip: {\n      position: 'absolute',\n      zIndex: 999,\n    },\n    modal: {\n      position: 'relative',\n      margin: 'auto',\n    },\n  },\n  popupArrow: {\n    height: '8px',\n    width: '16px',\n    position: 'absolute',\n    background: 'transparent',\n    color: '#FFF',\n    zIndex: -1,\n  },\n  overlay: {\n    tooltip: {\n      position: 'fixed',\n      top: '0',\n      bottom: '0',\n      left: '0',\n      right: '0',\n      zIndex: 999,\n    },\n    modal: {\n      position: 'fixed',\n      top: '0',\n      bottom: '0',\n      left: '0',\n      right: '0',\n      display: 'flex',\n      zIndex: 999,\n    },\n  },\n};\n\nexport default Style;\n","/* Algo to calculate position\n  1. center position for popup content : the center of the trigger will be the center of the content content\n      so the popup content position will be like this :\n      top => the y of the center for the trigger element : trigger.top + trigger.height/2\n      left => the x of the center for the trigger element : trigger.left + trigger.width/2\n\n  2. translate position according to the first  position attribute  passed  in the function argument\n      for example :\n        position = 'left top'\n        we need to handle the first argument in the position: 'left' => that's mean we need to translate the popup content according to the X axis by - content.width/2\n\n  3.translate position according to the first  position attribute  passed  in the function argument\n    for example :\n      position = 'left top'\n      the second argument 'top' => translate popup content by + content.height*4/5\n\n  4. check if calculated position is going out of bounds of wrapper box or not. If yes repeat 1-3 for next position enum. By default wrapper box is window element\n*/\nimport { PopupPosition } from './types';\n\nexport const POSITION_TYPES: PopupPosition[] = [\n  'top left',\n  'top center',\n  'top right',\n  'right top',\n  'right center',\n  'right bottom',\n  'bottom left',\n  'bottom center',\n  'bottom right',\n  'left top',\n  'left center',\n  'left bottom',\n  //'center center',\n];\n\ntype CordsType = {\n  top: number;\n  left: number;\n  transform: string;\n  arrowLeft: string;\n  arrowTop: string;\n};\n\nconst getCoordinatesForPosition = (\n  triggerBounding: DOMRect,\n  ContentBounding: DOMRect,\n  position: PopupPosition, //PopupPosition | PopupPosition[],\n  arrow: boolean,\n  { offsetX, offsetY }: { offsetX: number; offsetY: number }\n): CordsType => {\n  const margin = arrow ? 8 : 0;\n  const args = position.split(' ');\n  // the step N 1 : center the popup content => ok\n  const CenterTop = triggerBounding.top + triggerBounding.height / 2;\n  const CenterLeft = triggerBounding.left + triggerBounding.width / 2;\n  const { height, width } = ContentBounding;\n  let top = CenterTop - height / 2;\n  let left = CenterLeft - width / 2;\n  let transform = '';\n  let arrowTop = '0%';\n  let arrowLeft = '0%';\n  // the  step N 2 : => ok\n  switch (args[0]) {\n    case 'top':\n      top -= height / 2 + triggerBounding.height / 2 + margin;\n      transform = `rotate(180deg)  translateX(50%)`;\n      arrowTop = '100%';\n      arrowLeft = '50%';\n      break;\n    case 'bottom':\n      top += height / 2 + triggerBounding.height / 2 + margin;\n      transform = `rotate(0deg) translateY(-100%) translateX(-50%)`;\n      arrowLeft = '50%';\n      break;\n    case 'left':\n      left -= width / 2 + triggerBounding.width / 2 + margin;\n      transform = ` rotate(90deg)  translateY(50%) translateX(-25%)`;\n      arrowLeft = '100%';\n      arrowTop = '50%';\n      break;\n    case 'right':\n      left += width / 2 + triggerBounding.width / 2 + margin;\n      transform = `rotate(-90deg)  translateY(-150%) translateX(25%)`;\n      arrowTop = '50%';\n      break;\n    default:\n  }\n  switch (args[1]) {\n    case 'top':\n      top = triggerBounding.top;\n      arrowTop = `${triggerBounding.height / 2}px`;\n      break;\n    case 'bottom':\n      top = triggerBounding.top - height + triggerBounding.height;\n      arrowTop = `${height - triggerBounding.height / 2}px`;\n      break;\n    case 'left':\n      left = triggerBounding.left;\n      arrowLeft = `${triggerBounding.width / 2}px`;\n      break;\n    case 'right':\n      left = triggerBounding.left - width + triggerBounding.width;\n      arrowLeft = `${width - triggerBounding.width / 2}px`;\n      break;\n    default:\n  }\n\n  top = args[0] === 'top' ? top - offsetY : top + offsetY;\n  left = args[0] === 'left' ? left - offsetX : left + offsetX;\n\n  return { top, left, transform, arrowLeft, arrowTop };\n};\n\nexport const getTooltipBoundary = (keepTooltipInside: string | Boolean) => {\n  // add viewport\n  let boundingBox = {\n    top: 0,\n    left: 0,\n    /* eslint-disable-next-line no-undef */\n    width: window.innerWidth,\n    /* eslint-disable-next-line no-undef */\n    height: window.innerHeight,\n  };\n  if (typeof keepTooltipInside === 'string') {\n    /* eslint-disable-next-line no-undef */\n    const selector = document.querySelector(keepTooltipInside);\n    if (process.env.NODE_ENV !== 'production') {\n      if (selector === null)\n        throw new Error(\n          `${keepTooltipInside} selector does not exist : keepTooltipInside must be a valid html selector 'class' or 'Id'  or a boolean value`\n        );\n    }\n    if (selector !== null) boundingBox = selector.getBoundingClientRect();\n  }\n\n  return boundingBox;\n};\n\nconst calculatePosition = (\n  triggerBounding: DOMRect,\n  ContentBounding: DOMRect,\n  position: PopupPosition | PopupPosition[],\n  arrow: boolean,\n  { offsetX, offsetY }: { offsetX: number; offsetY: number },\n  keepTooltipInside: string | boolean\n): CordsType => {\n  let bestCoords: CordsType = {\n    arrowLeft: '0%',\n    arrowTop: '0%',\n    left: 0,\n    top: 0,\n    transform: 'rotate(135deg)',\n  };\n  let i = 0;\n  const wrapperBox = getTooltipBoundary(keepTooltipInside);\n  let positions = Array.isArray(position) ? position : [position];\n\n  // keepTooltipInside would be activated if the  keepTooltipInside exist or the position is Array\n  if (keepTooltipInside || Array.isArray(position))\n    positions = [...positions, ...POSITION_TYPES];\n\n  // add viewPort for WarpperBox\n  // wrapperBox.top = wrapperBox.top + window.scrollY;\n  // wrapperBox.left = wrapperBox.left + window.scrollX;\n\n  while (i < positions.length) {\n    bestCoords = getCoordinatesForPosition(\n      triggerBounding,\n      ContentBounding,\n      positions[i],\n      arrow,\n      { offsetX, offsetY }\n    );\n\n    const contentBox = {\n      top: bestCoords.top,\n      left: bestCoords.left,\n      width: ContentBounding.width,\n      height: ContentBounding.height,\n    };\n\n    if (\n      contentBox.top <= wrapperBox.top ||\n      contentBox.left <= wrapperBox.left ||\n      contentBox.top + contentBox.height >=\n        wrapperBox.top + wrapperBox.height ||\n      contentBox.left + contentBox.width >= wrapperBox.left + wrapperBox.width\n    ) {\n      i++;\n    } else {\n      break;\n    }\n  }\n\n  return bestCoords;\n};\n\nexport default calculatePosition;\n","import React, {\n  useState,\n  useRef,\n  useEffect,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport { PopupProps, PopupActions } from './types';\nimport {\n  useOnEscape,\n  useRepositionOnResize,\n  useOnClickOutside,\n  useTabbing,\n  useIsomorphicLayoutEffect,\n} from './hooks';\n\nimport './index.css';\n\nimport styles from './styles';\nimport calculatePosition from './Utils';\n\nlet popupIdCounter = 0;\n\nconst getRootPopup = () => {\n  let PopupRoot = document.getElementById('popup-root');\n\n  if (PopupRoot === null) {\n    PopupRoot = document.createElement('div');\n    PopupRoot.setAttribute('id', 'popup-root');\n    document.body.appendChild(PopupRoot);\n  }\n\n  return PopupRoot;\n};\n\nexport const Popup = forwardRef<PopupActions, PopupProps>(\n  (\n    {\n      trigger = null,\n      onOpen = () => {},\n      onClose = () => {},\n      defaultOpen = false,\n      open = undefined,\n      disabled = false,\n      nested = false,\n      closeOnDocumentClick = true,\n      repositionOnResize = true,\n      closeOnEscape = true,\n      on = ['click'],\n      contentStyle = {},\n      arrowStyle = {},\n      overlayStyle = {},\n      className = '',\n      position = 'bottom center',\n      modal = false,\n      lockScroll = false,\n      arrow = true,\n      offsetX = 0,\n      offsetY = 0,\n      mouseEnterDelay = 100,\n      mouseLeaveDelay = 100,\n      keepTooltipInside = false,\n      disableFocusContentOnOpen = false,\n      children,\n    },\n    ref\n  ) => {\n    const [isOpen, setIsOpen] = useState<boolean>(open || defaultOpen);\n    const triggerRef = useRef<HTMLElement>(null);\n    const contentRef = useRef<HTMLElement>(null);\n    const arrowRef = useRef<HTMLDivElement>(null);\n    const focusedElBeforeOpen = useRef<Element | null>(null);\n    const popupId = useRef<string>(`popup-${++popupIdCounter}`);\n\n    const isModal = modal ? true : !trigger;\n    const timeOut = useRef<any>(0);\n\n    useIsomorphicLayoutEffect(() => {\n      if (isOpen) {\n        focusedElBeforeOpen.current = document.activeElement;\n        setPosition();\n        focusContentOnOpen(); // for accessibility\n        lockScrolll();\n      } else {\n        resetScroll();\n      }\n      return () => {\n        clearTimeout(timeOut.current);\n      };\n    }, [isOpen]);\n\n    // for uncontrolled popup we need to sync isOpen with open prop\n    useEffect(() => {\n      if (typeof open === 'boolean') {\n        if (open) openPopup();\n        else closePopup();\n      }\n    }, [open, disabled]);\n\n    const openPopup = (event?: React.SyntheticEvent) => {\n      if (isOpen || disabled) return;\n      setIsOpen(true);\n      setTimeout(() => onOpen(event), 0);\n    };\n\n    const closePopup = (\n      event?: React.SyntheticEvent | KeyboardEvent | TouchEvent | MouseEvent\n    ) => {\n      if (!isOpen || disabled) return;\n      setIsOpen(false);\n      if (isModal) (focusedElBeforeOpen.current as HTMLElement)?.focus();\n      setTimeout(() => onClose(event), 0);\n    };\n\n    const togglePopup = (event?: React.SyntheticEvent) => {\n      event?.stopPropagation();\n      if (!isOpen) openPopup(event);\n      else closePopup(event);\n    };\n\n    const onMouseEnter = (event?: React.SyntheticEvent) => {\n      clearTimeout(timeOut.current);\n      timeOut.current = setTimeout(() => openPopup(event), mouseEnterDelay);\n    };\n\n    const onContextMenu = (event?: React.SyntheticEvent) => {\n      event?.preventDefault();\n      togglePopup();\n    };\n\n    const onMouseLeave = (event?: React.SyntheticEvent) => {\n      clearTimeout(timeOut.current);\n      timeOut.current = setTimeout(() => closePopup(event), mouseLeaveDelay);\n    };\n\n    const lockScrolll = () => {\n      if (isModal && lockScroll)\n        document.getElementsByTagName('body')[0].style.overflow = 'hidden'; // migrate to document.body\n    };\n\n    const resetScroll = () => {\n      if (isModal && lockScroll)\n        document.getElementsByTagName('body')[0].style.overflow = 'auto';\n    };\n    const focusContentOnOpen = () => {\n      if (disableFocusContentOnOpen) {\n        return;\n      }\n      const focusableEls = contentRef?.current?.querySelectorAll(\n        'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex=\"0\"]'\n      );\n      const firstEl = Array.prototype.slice.call(focusableEls)[0];\n      firstEl?.focus();\n    };\n\n    useImperativeHandle(ref, () => ({\n      open: () => {\n        openPopup();\n      },\n      close: () => {\n        closePopup();\n      },\n      toggle: () => {\n        togglePopup();\n      },\n    }));\n\n    // set Position\n    const setPosition = () => {\n      if (isModal || !isOpen) return;\n      if (!triggerRef?.current || !triggerRef?.current || !contentRef?.current)\n        return; /// show error as one of ref is undefined\n      const trigger = triggerRef.current.getBoundingClientRect();\n      const content = contentRef.current.getBoundingClientRect();\n\n      const cords = calculatePosition(\n        trigger,\n        content,\n        position,\n        arrow,\n        {\n          offsetX,\n          offsetY,\n        },\n        keepTooltipInside\n      );\n      contentRef.current.style.top = `${cords.top + window.scrollY}px`;\n      contentRef.current.style.left = `${cords.left + window.scrollX}px`;\n      if (arrow && !!arrowRef.current) {\n        arrowRef.current.style.transform = cords.transform;\n        arrowRef.current.style.setProperty('-ms-transform', cords.transform);\n        arrowRef.current.style.setProperty(\n          '-webkit-transform',\n          cords.transform\n        );\n        arrowRef.current.style.top =\n          arrowStyle.top?.toString() || cords.arrowTop;\n        arrowRef.current.style.left =\n          arrowStyle.left?.toString() || cords.arrowLeft;\n      }\n    };\n    // hooks\n    useOnEscape(closePopup, closeOnEscape); // can be optimized if we disabled for hover\n    useTabbing(contentRef, isOpen && isModal);\n    useRepositionOnResize(setPosition, repositionOnResize);\n    useOnClickOutside(\n      !!trigger ? [contentRef, triggerRef] : [contentRef],\n      closePopup,\n      closeOnDocumentClick && !nested\n    ); // we need to add a ne\n    // render the trigger element and add events\n    const renderTrigger = () => {\n      const triggerProps: any = {\n        key: 'T',\n        ref: triggerRef,\n        'aria-describedby': popupId.current,\n      };\n      const onAsArray = Array.isArray(on) ? on : [on];\n      for (let i = 0, len = onAsArray.length; i < len; i++) {\n        switch (onAsArray[i]) {\n          case 'click':\n            triggerProps.onClick = togglePopup;\n            break;\n          case 'right-click':\n            triggerProps.onContextMenu = onContextMenu;\n            break;\n          case 'hover':\n            triggerProps.onMouseEnter = onMouseEnter;\n            triggerProps.onMouseLeave = onMouseLeave;\n            break;\n          case 'focus':\n            triggerProps.onFocus = onMouseEnter;\n            triggerProps.onBlur = onMouseLeave;\n            break;\n          default:\n        }\n      }\n\n      if (typeof trigger === 'function') {\n        const comp = trigger(isOpen);\n        return !!trigger && React.cloneElement(comp, triggerProps);\n      }\n\n      return !!trigger && React.cloneElement(trigger, triggerProps);\n    };\n\n    const addWarperAction = () => {\n      const popupContentStyle = isModal\n        ? styles.popupContent.modal\n        : styles.popupContent.tooltip;\n\n      const childrenElementProps: any = {\n        className: `popup-content ${\n          className !== ''\n            ? className\n                .split(' ')\n                .map(c => `${c}-content`)\n                .join(' ')\n            : ''\n        }`,\n        style: {\n          ...popupContentStyle,\n          ...contentStyle,\n          pointerEvents: 'auto', //closeOnDocumentClick && nested ? 'auto' : 'none',\n        },\n        ref: contentRef,\n        onClick: (e: any) => {\n          e.stopPropagation();\n        },\n      };\n      if (!modal && on.indexOf('hover') >= 0) {\n        childrenElementProps.onMouseEnter = onMouseEnter;\n        childrenElementProps.onMouseLeave = onMouseLeave;\n      }\n      return childrenElementProps;\n    };\n\n    const renderContent = () => {\n      return (\n        <div\n          {...addWarperAction()}\n          key=\"C\"\n          role={isModal ? 'dialog' : 'tooltip'}\n          id={popupId.current}\n        >\n          {arrow && !isModal && (\n            <div ref={arrowRef} style={styles.popupArrow}>\n              <svg\n                data-testid=\"arrow\"\n                className={`popup-arrow ${\n                  className !== ''\n                    ? className\n                        .split(' ')\n                        .map(c => `${c}-arrow`)\n                        .join(' ')\n                    : ''\n                }`}\n                viewBox=\"0 0 32 16\"\n                style={{\n                  position: 'absolute',\n                  ...arrowStyle,\n                }}\n              >\n                <path d=\"M16 0l16 16H0z\" fill=\"currentcolor\" />\n              </svg>\n            </div>\n          )}\n          {children && typeof children === 'function'\n            ? children(closePopup, isOpen)\n            : children}\n        </div>\n      );\n    };\n\n    const overlay = !(on.indexOf('hover') >= 0);\n    const ovStyle = isModal ? styles.overlay.modal : styles.overlay.tooltip;\n\n    const content = [\n      overlay && (\n        <div\n          key=\"O\"\n          data-testid=\"overlay\"\n          data-popup={isModal ? 'modal' : 'tooltip'}\n          className={`popup-overlay ${\n            className !== ''\n              ? className\n                  .split(' ')\n                  .map(c => `${c}-overlay`)\n                  .join(' ')\n              : ''\n          }`}\n          style={{\n            ...ovStyle,\n            ...overlayStyle,\n            pointerEvents:\n              (closeOnDocumentClick && nested) || isModal ? 'auto' : 'none',\n          }}\n          onClick={closeOnDocumentClick && nested ? closePopup : undefined}\n          tabIndex={-1}\n        >\n          {isModal && renderContent()}\n        </div>\n      ),\n\n      !isModal && renderContent(),\n    ];\n\n    return (\n      <>\n        {renderTrigger()}\n        {isOpen && ReactDOM.createPortal(content, getRootPopup())}\n      </>\n    );\n  }\n);\n\nexport default Popup;\n"],"names":["useOnEscape","handler","active","useEffect","listener","event","key","document","addEventListener","removeEventListener","useRepositionOnResize","window","useOnClickOutside","ref","refs","Array","isArray","contains","forEach","r","current","target","stopPropagation","useTabbing","contentRef","keyCode","els","querySelectorAll","focusableEls","prototype","slice","call","length","preventDefault","firstFocusableEl","lastFocusableEl","shiftKey","activeElement","focus","useIsomorphicLayoutEffect","useLayoutEffect","Style","popupContent","tooltip","position","zIndex","modal","margin","popupArrow","height","width","background","color","overlay","top","bottom","left","right","display","POSITION_TYPES","getCoordinatesForPosition","triggerBounding","ContentBounding","arrow","offsetX","offsetY","args","split","CenterTop","CenterLeft","transform","arrowTop","arrowLeft","getTooltipBoundary","keepTooltipInside","boundingBox","innerWidth","innerHeight","selector","querySelector","Error","getBoundingClientRect","calculatePosition","bestCoords","i","wrapperBox","positions","contentBox","popupIdCounter","getRootPopup","PopupRoot","getElementById","createElement","setAttribute","body","appendChild","Popup","forwardRef","trigger","onOpen","onClose","defaultOpen","open","undefined","disabled","nested","closeOnDocumentClick","repositionOnResize","closeOnEscape","on","contentStyle","arrowStyle","overlayStyle","className","lockScroll","mouseEnterDelay","mouseLeaveDelay","disableFocusContentOnOpen","children","useState","isOpen","setIsOpen","triggerRef","useRef","arrowRef","focusedElBeforeOpen","popupId","isModal","timeOut","setPosition","focusContentOnOpen","lockScrolll","resetScroll","clearTimeout","openPopup","closePopup","setTimeout","togglePopup","onMouseEnter","onContextMenu","onMouseLeave","getElementsByTagName","style","overflow","firstEl","useImperativeHandle","close","toggle","content","cords","scrollY","scrollX","setProperty","toString","renderTrigger","triggerProps","onAsArray","len","onClick","onFocus","onBlur","comp","React","cloneElement","addWarperAction","popupContentStyle","styles","childrenElementProps","map","c","join","pointerEvents","e","indexOf","renderContent","role","id","viewBox","d","fill","ovStyle","tabIndex","ReactDOM","createPortal"],"mappings":"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"}